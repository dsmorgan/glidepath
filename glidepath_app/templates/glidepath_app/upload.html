{% extends 'glidepath_app/base.html' %}
{% block title %}Glidepath - Rules{% endblock %}
{% block content %}
<div class="bg-white shadow rounded-lg p-6">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">Glidepath Rules</h1>

    {% if error %}
    <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-4">
        <p class="text-red-700">{{ error }}</p>
    </div>
    {% endif %}

    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
        <div class="flex flex-wrap items-center gap-4">
            <!-- Ruleset Selector -->
            <div class="flex-1 min-w-[200px]">
                <label class="block text-sm font-medium text-gray-700 mb-1">Select Ruleset</label>
                <form method="get">
                    <select name="ruleset" class="w-full border border-gray-300 rounded-md p-2" hx-get="{% url 'rules' %}" hx-target="#rules" hx-trigger="change" hx-include="this">
                        <option value="">-- Select a Ruleset --</option>
                        {% for rs in rule_sets %}
                            <option value="{{ rs.id }}" {% if selected_set and rs.id == selected_set.id %}selected{% endif %}>{{ rs.name }}</option>
                        {% endfor %}
                    </select>
                    <noscript><button type="submit" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">View</button></noscript>
                </form>
            </div>

            <!-- Actions -->
            <div class="flex gap-2 items-end">
                <!-- Export Button -->
                <a href="{% if selected_set %}{% url 'export_rules' %}?ruleset={{ selected_set.id }}{% else %}#{% endif %}"
                   class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center whitespace-nowrap {% if not selected_set %}pointer-events-none opacity-50{% endif %}">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Export CSV
                </a>

                <!-- Delete Button -->
                <form method="post" class="inline-block">
                    {% csrf_token %}
                    <input type="hidden" name="delete" value="{{ selected_set.id }}">
                    <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap" {% if not selected_set %}disabled{% endif %}>
                        Delete Ruleset
                    </button>
                </form>

                <!-- Upload Button -->
                <form method="post" enctype="multipart/form-data" class="inline-block">
                    {% csrf_token %}
                    <div class="flex gap-2">
                        <input type="file" name="file" required class="border border-gray-300 rounded-md p-2 text-sm">
                        <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 whitespace-nowrap">
                            Upload CSV
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="rules">
        {% include 'glidepath_app/rules.html' %}
    </div>
</div>
{% endblock %}
