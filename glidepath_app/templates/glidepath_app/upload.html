<!DOCTYPE html>
<html>
<head>
    <title>Glidepath Rules</title>
</head>
<body>
<h1>Glidepath Rules</h1>
{% if error %}
<p style="color:red;">{{ error }}</p>
{% endif %}
<form method="get">
    <select name="ruleset" onchange="this.form.submit()">
        {% for rs in rule_sets %}
            <option value="{{ rs.id }}" {% if selected_set and rs.id == selected_set.id %}selected{% endif %}>{{ rs.name }}</option>
        {% endfor %}
    </select>
    <noscript><button type="submit">View</button></noscript>
</form>
<form method="post" style="display:inline;">
    {% csrf_token %}
    <input type="hidden" name="delete" value="{{ selected_set.id }}">
    <button type="submit" {% if not selected_set %}disabled{% endif %}>Delete</button>
</form>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" name="file" required>
    <button type="submit">Upload</button>
</form>
{% if selected_set %}
<p><a href="{% url 'export_rules' %}?ruleset={{ selected_set.id }}">Export CSV</a></p>
{% endif %}
<table border="1">
    <thead>
        <tr>
            <th>gt-retire-age</th>
            <th>lt-retire-age</th>
            <th>Classes</th>
            <th>Categories</th>
        </tr>
    </thead>
    <tbody>
    {% for rule in rules %}
        <tr>
            <td>{{ rule.gt_retire_age }}</td>
            <td>{{ rule.lt_retire_age }}</td>
            <td>
                {% for ca in rule.class_allocations.all %}
                    {{ ca.asset_class.name }}: {{ ca.percentage }}%<br>
                {% endfor %}
            </td>
            <td>
                {% for ca in rule.category_allocations.all %}
                    {{ ca.asset_category.asset_class.name }}:{{ ca.asset_category.name }}: {{ ca.percentage }}%<br>
                {% endfor %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
</body>
</html>
